-- --------------------------------------------------------------------------------------------------

CREATE TABLE printshop_global.notifier_templates (
    template_id int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT pk_notifier_templates PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    template_group int2 NOT NULL, -- 1=USERS, 2=ADMINS
    template_name character varying(64) NULL,
    lang_code character(5) NOT NULL, -- en_EN, ru_RU
    template_caption character varying(128) NOT NULL,
    notice_props jsonb NOT NULL,
    notice_body text NOT NULL,
    notice_vars jsonb NOT NULL, -- cache from notice_props and notice_body
    template_status int2 NOT NULL, -- 1=DRAFT, 2=ENABLED, 3=DISABLED
    created_at timestamp with time zone NOT NULL DEFAULT NOW(),
    updated_at timestamp with time zone NOT NULL DEFAULT NOW(),
    deleted_at timestamp with time zone NULL
);

CREATE UNIQUE INDEX uk_notifier_templates_template_name ON printshop_global.notifier_templates (template_name, lang_code) WHERE deleted_at IS NULL;

-- INSERT INTO printshop_global.notifier_templates (notice_id, tag_version, notice_group, lang_code, param_name, notice_subject, notice_data, notice_body, notice_status, created_at, updated_at, deleted_at)
-- (10,'users','eng','auth.login.code','Project Team','','','','text/plain','xxx Alert. Запрос на вход в систему','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВНИМАНИЕ! Кто-то пытается войти в систему под вашей учётной записью %userLogin%.\r\nЕсли это делаете не Вы, то значит ваши логин и пароль стали известны третим лицам, в этом случае срочно поменяйте свой пароль перейдя по следующей ссылке: %linkChangePassword%\r\n\r\nДля подтверждения необходимо ввести следующий код: %confirmCode%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(11,'users','eng','auth.accessrecovery.confirm','Project Team','','','','text/plain','xxx Alert. Запрос на восстановление доступа','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВы запросили восстановления доступа к своей учётной записи %userLogin%.\r\nЕсли Вы не делали этого, значит кто-то по ошибке указал Ваш логин или емаил адрес. В таком случае просто проигнорируйте данное письмо.\r\n\r\nДля установки нового пароля к учётной записи Вам необходимо перейти по следующей ссылке: %linkSetPassword%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(12,'users','eng','auth.changeemail.code','Project Team','','','','text/plain','xxx Alert. Запрос на изменение емаил адреса','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВНИМАНИЕ! Кто-то пытается изменить емаил адрес привязанный к вашей учётной записи %userLogin%.\r\nЕсли это делаете не Вы, то значит ваши логин и пароль стали известны третим лицам, в этом случае срочно поменяйте свой пароль перейдя по следующей ссылке: %linkChangePassword%\r\n\r\nДля подтверждения необходимо ввести следующий код: %confirmCode%\r\nОбратите внимание! До тех пор, пока новый емаил адрес не будет подтверждён, будет действовать старый емаил адрес, на который пришло это письмо.\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(13,'users','eng','auth.confirmemail.code','Project Team','','','','text/plain','xxx Alert. Запрос на привязку емаил адреса','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВы запросили привязать данный емаил адрес к учётной записи %userLogin%.\r\nЕсли Вы не делали этого, значит кто-то по ошибке указал Ваш емаил адрес. В таком случае просто проигнорируйте данное письмо.\r\n\r\nДля подтверждения необходимо ввести следующий код: %confirmCode%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(14,'users','eng','auth.changepassword.code','Project Team','','','','text/plain','xxx Alert. Запрос на изменение пароля','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВНИМАНИЕ! Кто-то пытается изменить пароль от вашей учётной записи %userLogin%.\r\nЕсли это делаете не Вы, то значит ваши логин и пароль стали известны третим лицам, в этом случае срочно поменяйте свой пароль перейдя по следующей ссылке: %linkChangePassword%\r\n\r\nДля подтверждения необходимо ввести следующий код: %confirmCode%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(20,'users','eng','account.registration.confirm','Project Team','','','','text/plain','Подтверждение регистрации аккаунта %accountLogin%','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВы зарегистрировались в системе xxx под учётной записью %accountLogin%.\r\nЕсли Вы не регистрировались, значит кто-то ошибочно указал Ваш емаил адрес во время регистрации в системе. В таком случае просто проигнорируйте данное письмо.\r\nДля активации Вашей учётной записи, пожалуйста, нажмите на следующую ссылку: %linkConfirmAction%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(21,'users','eng','account.activated.success','Project Team','','','','text/plain','Аккаунт %accountLogin% успешно активирован','','Сообщение от автоматической службы системы xxx:\r\n\r\nЗдравствуйте!\r\n\r\nВаша учётная запись была успешно %accountLogin% активирована.\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(30,'admins','eng','account.registration.notice','Project Team','','','mondegor@gmail.com','text/plain','Аккаунт %accountId% зарегистрирован','','Новый аккаунт %accountId% зарегистрирован в системе, в качестве емаил адреса был указан %accountEmail%.\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(31,'admins','eng','account.activated.notice','Project Team','','','mondegor@gmail.com','text/plain','Аккаунт %accountId% активирован','','Аккаунт %accountId% активирован в системе, в качестве емаил адреса был указан %accountEmail%.\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL),(32,'admins','eng','account.support.notice','Project Team','','','mondegor@gmail.com','text/plain','Новое сообщение от аккаунта %accountId%','','Новое сообщение от аккаунта %accountId%:\r\n\r\nEmail: %accountEmail%\r\nName: %accountName%\r\n\r\nТекст сообщения:\r\n%messageText%\r\n\r\nС уважением, администрация системы xxx.','','enabled',NULL,0,0,0,'2022-06-01 00:00:00',0,NULL);

-- --------------------------------------------------------------------------------------------------

CREATE TABLE printshop_global.notifier_template_vars (
    var_name character varying(32) CONSTRAINT pk_notifier_template_vars PRIMARY KEY,
    default_value character varying(128) NOT NULL,
    var_description character varying(1024) NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT NOW(),
    updated_at timestamp with time zone NOT NULL DEFAULT NOW()
);

CREATE UNIQUE INDEX uk_notifier_notice_vars_var_name ON printshop_global.notifier_template_vars (var_name);

-- INSERT INTO printshop_global.notifier_notice_vars VALUES (1,'preheader','','Заголовок, который вставляется в тело уведомления'),(5,'linkConfirmAction','','Ссылка на подтверждение действия пользователя (активация в системе, изменения емаила, пароля и т.д.)'),(20,'accountId','','Аккаунт пользователя'),(21,'accountLogin','','Логин пользователя'),(22,'accountEmail','','E-mail для уведомлений пользователя'),(23,'userName','','Имя пользователя'),(24,'userSurname','','Фамилия пользователя'),(25,'userMessage','','Текст сообщения от пользователя'),(26,'linkSetPassword','','Ссылка на установку нового пароля'),(27,'linkChangeEmail','','Ссылка на подтверждение изменения емаила');
